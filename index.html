<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Phát triển Cá nhân - Ghi Chú</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .note-content, .edit-textarea { /* Áp dụng style cho cả p và textarea */
            white-space: pre-wrap;
            word-break: break-word;
        }
        .edit-textarea { /* Style riêng cho textarea khi sửa */
            min-height: 60px; /* Chiều cao tối thiểu */
        }
        /* Style cho các nút nhỏ hơn */
        .action-button {
            font-size: 0.875rem; /* text-sm */
            padding: 0.25rem 0.5rem; /* py-1 px-2 */
            margin-left: 0.5rem; /* ml-2 */
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.15s ease-in-out;
            font-weight: 500; /* medium */
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-blue-600 text-white p-4 shadow-md">
        <div class="container mx-auto">
            <h1 class="text-2xl font-bold">Ứng dụng Cá nhân Của Tôi</h1>
            </div>
    </header>

    <main class="container mx-auto p-4 mt-4">
        <div id="app-content" class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Ghi Chú Nhanh</h2>

            <div class="mb-4">
                <textarea id="note-input" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="Nhập ghi chú của bạn ở đây..."></textarea>
            </div>
            <button id="add-note-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">
                Thêm Ghi Chú
            </button>

            <div id="notes-list" class="mt-6 space-y-3">
                </div>
        </div>
    </main>

    <footer class="text-center text-gray-500 mt-8 p-4">
        <p>&copy; 2025 - Tạo bởi Bạn & Gemini</p>
    </footer>

    <script>
        const noteInput = document.getElementById('note-input');
        const addNoteBtn = document.getElementById('add-note-btn');
        const notesList = document.getElementById('notes-list');

        // --- Note Management ---

        function getNotes() {
            const notes = localStorage.getItem('quickNotes');
            return notes ? JSON.parse(notes) : [];
        }

        function saveNotes(notes) {
            localStorage.setItem('quickNotes', JSON.stringify(notes));
        }

        function displayNotes() {
            const notes = getNotes();
            notesList.innerHTML = ''; // Clear current list

            if (notes.length === 0) {
                notesList.innerHTML = '<p class="text-gray-500">Chưa có ghi chú nào.</p>';
                return;
            }

            notes.sort((a, b) => b.id - a.id); // Show newest first

            notes.forEach(note => {
                const noteElement = document.createElement('div');
                // Store note id directly on the element for easy access
                noteElement.dataset.noteId = note.id;
                noteElement.classList.add('bg-yellow-100', 'p-3', 'rounded-md', 'shadow-sm', 'flex', 'justify-between', 'items-start');

                // Container for content (will hold <p> or <textarea>)
                const contentContainer = document.createElement('div');
                contentContainer.classList.add('flex-grow', 'mr-2');

                const contentElement = document.createElement('p');
                contentElement.classList.add('note-content', 'text-gray-700');
                contentElement.textContent = note.content;
                contentContainer.appendChild(contentElement);

                // Container for buttons
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('flex-shrink-0', 'flex'); // Use flex for button alignment

                // Edit Button
                const editButton = document.createElement('button');
                editButton.classList.add('text-blue-600', 'hover:text-blue-800', 'action-button');
                editButton.textContent = 'Sửa';
                editButton.onclick = () => toggleEdit(note.id);

                // Delete Button
                const deleteButton = document.createElement('button');
                deleteButton.classList.add('text-red-500', 'hover:text-red-700', 'action-button');
                deleteButton.textContent = 'Xóa';
                deleteButton.onclick = () => deleteNote(note.id);

                buttonContainer.appendChild(editButton);
                buttonContainer.appendChild(deleteButton);

                noteElement.appendChild(contentContainer);
                noteElement.appendChild(buttonContainer);
                notesList.appendChild(noteElement);
            });
        }

        function addNote() {
            const noteContent = noteInput.value.trim();
            if (noteContent) {
                const notes = getNotes();
                const newNote = {
                    id: Date.now(),
                    content: noteContent
                };
                notes.push(newNote);
                saveNotes(notes);
                noteInput.value = '';
                displayNotes();
                console.log("Added note:", newNote);
            } else {
                console.log("Note content is empty.");
                // Optionally show an error message to the user
            }
        }

        function deleteNote(noteId) {
            // Optional: Add a confirmation dialog
            // if (!confirm("Bạn có chắc muốn xóa ghi chú này?")) {
            //     return;
            // }
            let notes = getNotes();
            notes = notes.filter(note => note.id !== noteId);
            saveNotes(notes);
            displayNotes();
            console.log("Deleted note ID:", noteId);
        }

        // Function to toggle between view and edit mode
        function toggleEdit(noteId) {
            const noteElement = notesList.querySelector(`[data-note-id='${noteId}']`);
            if (!noteElement) return; // Should not happen

            const contentContainer = noteElement.querySelector('div:first-child'); // First div holds content
            const buttonContainer = noteElement.querySelector('div:last-child');  // Last div holds buttons
            const isEditing = noteElement.classList.contains('editing');

            if (isEditing) {
                // If currently editing, switch back to view mode (Cancel functionality)
                // Simply re-displaying notes handles this cleanly
                displayNotes();
            } else {
                // Switch to edit mode
                // First, cancel any other potential edits by redrawing
                displayNotes();
                // Find the element again after redraw
                const freshNoteElement = notesList.querySelector(`[data-note-id='${noteId}']`);
                if (!freshNoteElement) return;

                const freshContentContainer = freshNoteElement.querySelector('div:first-child');
                const freshButtonContainer = freshNoteElement.querySelector('div:last-child');
                const notes = getNotes();
                const note = notes.find(n => n.id === noteId);

                if (!note) return; // Note not found

                // Create textarea for editing
                const editInput = document.createElement('textarea');
                editInput.classList.add('w-full', 'p-1', 'border', 'border-gray-300', 'rounded-md', 'focus:outline-none', 'focus:ring-1', 'focus:ring-blue-500', 'edit-textarea', 'note-content'); // Reuse note-content class
                editInput.value = note.content;

                // Create Save button
                const saveButton = document.createElement('button');
                saveButton.classList.add('text-green-600', 'hover:text-green-800', 'action-button');
                saveButton.textContent = 'Lưu';
                saveButton.onclick = () => saveEdit(noteId, editInput.value);

                // Create Cancel button
                const cancelButton = document.createElement('button');
                cancelButton.classList.add('text-gray-600', 'hover:text-gray-800', 'action-button');
                cancelButton.textContent = 'Hủy';
                cancelButton.onclick = () => displayNotes(); // Cancel reverts by re-displaying

                // Replace content and buttons
                freshContentContainer.innerHTML = ''; // Clear the <p> tag
                freshContentContainer.appendChild(editInput);

                freshButtonContainer.innerHTML = ''; // Clear Edit/Delete buttons
                freshButtonContainer.appendChild(saveButton);
                freshButtonContainer.appendChild(cancelButton);

                freshNoteElement.classList.add('editing'); // Mark as editing
                editInput.focus(); // Focus the textarea
            }
        }

        // Function to save the edited note
        function saveEdit(noteId, newContent) {
            const trimmedContent = newContent.trim();
            if (!trimmedContent) {
                console.log("Note content cannot be empty after edit.");
                // Optionally show error or delete if empty
                // For now, let's just cancel the edit if empty
                displayNotes();
                return;
            }

            let notes = getNotes();
            const noteIndex = notes.findIndex(note => note.id === noteId);

            if (noteIndex > -1) {
                notes[noteIndex].content = trimmedContent;
                saveNotes(notes);
                displayNotes(); // Refresh the list to show updated note
                console.log("Saved edit for note ID:", noteId);
            } else {
                console.error("Could not find note to save:", noteId);
                displayNotes(); // Refresh to clear inconsistent state
            }
        }


        // --- Initialization and Event Listeners ---

        addNoteBtn.addEventListener('click', addNote);

        noteInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                addNote();
            }
        });

        document.addEventListener('DOMContentLoaded', displayNotes);

        console.log("Quick Notes App (with Edit) is ready!");

    </script>

</body>
</html>
