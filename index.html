<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Phát triển Cá nhân</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styles for Notes */
        .note-content, .edit-textarea {
            white-space: pre-wrap;
            word-break: break-word;
        }
        .edit-textarea { min-height: 60px; }
        .note-timestamp { font-size: 0.75rem; color: #6b7280; margin-top: 0.5rem; }

        /* Styles for Goals */
        .goal-item.completed .goal-name {
            text-decoration: line-through;
            color: #6b7280; /* text-gray-500 */
        }
        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem; /* p-3 */
            border-radius: 0.375rem; /* rounded-md */
            background-color: #f3f4f6; /* bg-gray-100 */
            margin-bottom: 0.75rem; /* mb-3 */
        }
         .goal-item.completed {
             background-color: #e5e7eb; /* bg-gray-200 */
         }
        .goal-name {
            flex-grow: 1;
            margin-right: 0.5rem; /* mr-2 */
        }

        /* General Styles */
        .action-button {
            font-size: 0.875rem; padding: 0.25rem 0.5rem; margin-left: 0.5rem;
            border-radius: 0.375rem; transition: background-color 0.15s ease-in-out, color 0.15s ease-in-out;
            font-weight: 500;
        }
        .nav-link {
            padding: 0.5rem 1rem; border-radius: 0.375rem;
            transition: background-color 0.15s ease-in-out; cursor: pointer; font-weight: 500;
        }
        .nav-link:hover { background-color: rgba(255, 255, 255, 0.1); }
        .nav-link.active { background-color: rgba(255, 255, 255, 0.2); font-weight: 600; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-blue-600 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Ứng dụng Cá nhân</h1>
            <nav id="main-nav">
                <ul class="flex space-x-2">
                    <li><a href="#" id="nav-notes" class="nav-link" data-module="notes">Ghi chú</a></li>
                    <li><a href="#" id="nav-goals" class="nav-link" data-module="goals">Mục tiêu</a></li>
                    </ul>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 mt-4">
        <div id="app-content" class="bg-white p-6 rounded-lg shadow-md min-h-[300px]">
            <p>Đang tải...</p>
        </div>
    </main>

    <footer class="text-center text-gray-500 mt-8 p-4">
        <p>&copy; 2025 - Tạo bởi Bạn & Gemini</p>
    </footer>

    <script>
        // --- Global State and Elements ---
        let currentModule = 'notes';
        const appContent = document.getElementById('app-content');
        const mainNav = document.getElementById('main-nav');
        const navLinks = mainNav.querySelectorAll('.nav-link');

        // --- Module Building Functions ---

        function buildNotesUI() {
            // (Code for buildNotesUI remains the same as previous version)
            appContent.innerHTML = `
                <h2 class="text-xl font-semibold mb-4">Ghi Chú Nhanh</h2>
                <div class="mb-4">
                    <textarea id="note-input" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4" placeholder="Nhập ghi chú của bạn ở đây..."></textarea>
                </div>
                <button id="add-note-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out mb-6">
                    Thêm Ghi Chú
                </button>
                <div class="mb-4">
                    <input type="search" id="search-input" placeholder="Tìm kiếm ghi chú..." class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div id="notes-list" class="mt-6 space-y-3">
                    </div>
            `;
            const noteInput = document.getElementById('note-input');
            const addNoteBtn = document.getElementById('add-note-btn');
            const searchInput = document.getElementById('search-input');
            const notesList = document.getElementById('notes-list');
            addNoteBtn.addEventListener('click', () => addNote(noteInput, searchInput));
            noteInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); addNote(noteInput, searchInput); }
            });
            searchInput.addEventListener('input', (event) => displayNotes(notesList, searchInput, event.target.value));
            displayNotes(notesList, searchInput);
        }

        // *** NEW: Build Goals UI Function ***
        function buildGoalsUI() {
            appContent.innerHTML = `
                <h2 class="text-xl font-semibold mb-4">Theo dõi Mục tiêu</h2>
                <form id="add-goal-form" class="mb-6 flex items-center space-x-2">
                    <input type="text" id="goal-input" placeholder="Nhập mục tiêu mới..." required class="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out">
                        Thêm Mục tiêu
                    </button>
                </form>
                <div id="goals-list" class="space-y-3">
                    </div>
            `;

            // Get references to new elements
            const addGoalForm = document.getElementById('add-goal-form');
            const goalInput = document.getElementById('goal-input');
            const goalsList = document.getElementById('goals-list');

            // Attach event listeners
            addGoalForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission
                addGoal(goalInput, goalsList);
            });

            // Initial display of goals
            displayGoals(goalsList);
        }

        // --- Core Application Logic ---

        function renderAppContent() {
            console.log(`Rendering module: ${currentModule}`);
            document.title = `Ứng dụng Cá nhân - ${currentModule === 'notes' ? 'Ghi Chú' : 'Mục tiêu'}`;

            navLinks.forEach(link => {
                link.classList.toggle('active', link.dataset.module === currentModule);
            });

            switch (currentModule) {
                case 'notes':
                    buildNotesUI();
                    break;
                case 'goals':
                    buildGoalsUI(); // Call the new function
                    break;
                default:
                    appContent.innerHTML = '<p>Module không xác định.</p>';
            }
        }

        // --- Note Management Functions ---
        // (Code for getNotes, saveNotes, formatTimestamp, displayNotes, addNote, deleteNote, toggleEdit, saveEdit remains the same)
        function getNotes() { /* ... */
            const notes = localStorage.getItem('quickNotes');
            try {
                const parsedNotes = notes ? JSON.parse(notes) : [];
                return parsedNotes.map(note => ({ ...note }));
            } catch (e) { console.error("Error parsing notes:", e); return []; }
        }
        function saveNotes(notes) { /* ... */
             localStorage.setItem('quickNotes', JSON.stringify(notes));
        }
        function formatTimestamp(timestamp) { /* ... */
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return `${date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}, ${date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' })}`;
        }
        function displayNotes(notesListElement, searchInputElement, searchTerm = '') { /* ... */
             if (!notesListElement || !searchInputElement) { return; }
            let notes = getNotes();
            const normalizedSearchTerm = searchTerm.toLowerCase().trim();
            if (normalizedSearchTerm) { notes = notes.filter(note => note.content.toLowerCase().includes(normalizedSearchTerm)); }
            notesListElement.innerHTML = '';
            if (notes.length === 0) { notesListElement.innerHTML = `<p class="text-gray-500">${normalizedSearchTerm ? 'Không tìm thấy ghi chú nào khớp.' : 'Chưa có ghi chú nào.'}</p>`; return; }
            notes.sort((a, b) => (b.modifiedAt || b.createdAt) - (a.modifiedAt || a.createdAt));
            notes.forEach(note => {
                const noteElement = document.createElement('div'); noteElement.dataset.noteId = note.id; noteElement.classList.add('bg-yellow-100', 'p-3', 'rounded-md', 'shadow-sm', 'flex', 'flex-col');
                const topRow = document.createElement('div'); topRow.classList.add('flex', 'justify-between', 'items-start', 'w-full');
                const contentContainer = document.createElement('div'); contentContainer.classList.add('flex-grow', 'mr-2');
                const contentElement = document.createElement('p'); contentElement.classList.add('note-content', 'text-gray-700'); contentElement.textContent = note.content; contentContainer.appendChild(contentElement);
                const buttonContainer = document.createElement('div'); buttonContainer.classList.add('flex-shrink-0', 'flex');
                const editButton = document.createElement('button'); editButton.classList.add('text-blue-600', 'hover:text-blue-800', 'action-button'); editButton.textContent = 'Sửa'; editButton.onclick = () => toggleEdit(note.id, notesListElement, searchInputElement);
                const deleteButton = document.createElement('button'); deleteButton.classList.add('text-red-500', 'hover:text-red-700', 'action-button'); deleteButton.textContent = 'Xóa'; deleteButton.onclick = () => deleteNote(note.id, notesListElement, searchInputElement);
                buttonContainer.appendChild(editButton); buttonContainer.appendChild(deleteButton);
                topRow.appendChild(contentContainer); topRow.appendChild(buttonContainer);
                const timestampElement = document.createElement('p'); timestampElement.classList.add('note-timestamp', 'w-full', 'text-right'); const created = formatTimestamp(note.createdAt); const modified = formatTimestamp(note.modifiedAt); timestampElement.textContent = modified ? `Sửa đổi: ${modified}` : (created ? `Đã tạo: ${created}` : '');
                noteElement.appendChild(topRow); if (timestampElement.textContent) { noteElement.appendChild(timestampElement); }
                notesListElement.appendChild(noteElement);
            });
        }
        function addNote(noteInputElement, searchInputElement) { /* ... */
             if (!noteInputElement || !searchInputElement) return;
            const noteContent = noteInputElement.value.trim();
            if (noteContent) {
                const notes = getNotes(); const now = Date.now();
                const newNote = { id: now, content: noteContent, createdAt: now, modifiedAt: null };
                notes.push(newNote); saveNotes(notes);
                noteInputElement.value = ''; searchInputElement.value = '';
                const currentNotesList = document.getElementById('notes-list');
                if(currentNotesList) { displayNotes(currentNotesList, searchInputElement); }
            }
        }
        function deleteNote(noteId, notesListElement, searchInputElement) { /* ... */
            if (!window.confirm("Bạn có chắc muốn xóa ghi chú này không?")) { return; }
            let notes = getNotes(); notes = notes.filter(note => note.id !== noteId); saveNotes(notes);
            displayNotes(notesListElement, searchInputElement, searchInputElement.value);
        }
        function toggleEdit(noteId, notesListElement, searchInputElement) { /* ... */
             displayNotes(notesListElement, searchInputElement, searchInputElement.value);
            const noteElement = notesListElement.querySelector(`[data-note-id='${noteId}']`); if (!noteElement) return;
            const topRow = noteElement.querySelector('div:first-child'); const contentContainer = topRow.querySelector('div:first-child'); const buttonContainer = topRow.querySelector('div:last-child');
            const notes = getNotes(); const note = notes.find(n => n.id === noteId); if (!note) return;
            const editInput = document.createElement('textarea'); editInput.classList.add('w-full', 'p-1', 'border', 'border-gray-300', 'rounded-md', 'focus:outline-none', 'focus:ring-1', 'focus:ring-blue-500', 'edit-textarea', 'note-content'); editInput.value = note.content;
            const saveButton = document.createElement('button'); saveButton.classList.add('text-green-600', 'hover:text-green-800', 'action-button'); saveButton.textContent = 'Lưu'; saveButton.onclick = () => saveEdit(noteId, editInput.value, notesListElement, searchInputElement);
            const cancelButton = document.createElement('button'); cancelButton.classList.add('text-gray-600', 'hover:text-gray-800', 'action-button'); cancelButton.textContent = 'Hủy'; cancelButton.onclick = () => displayNotes(notesListElement, searchInputElement, searchInputElement.value);
            contentContainer.innerHTML = ''; contentContainer.appendChild(editInput);
            buttonContainer.innerHTML = ''; buttonContainer.appendChild(saveButton); buttonContainer.appendChild(cancelButton);
            noteElement.classList.add('editing'); editInput.focus();
        }
        function saveEdit(noteId, newContent, notesListElement, searchInputElement) { /* ... */
             const trimmedContent = newContent.trim();
            if (!trimmedContent) { displayNotes(notesListElement, searchInputElement, searchInputElement.value); return; }
            let notes = getNotes(); const noteIndex = notes.findIndex(note => note.id === noteId);
            if (noteIndex > -1) {
                notes[noteIndex].content = trimmedContent; notes[noteIndex].modifiedAt = Date.now(); saveNotes(notes);
                displayNotes(notesListElement, searchInputElement, searchInputElement.value);
            } else { console.error("Could not find note to save:", noteId); displayNotes(notesListElement, searchInputElement, searchInputElement.value); }
        }


        // --- *** NEW: Goal Management Functions *** ---

        const GOALS_STORAGE_KEY = 'personalGoals'; // Key for localStorage

        function getGoals() {
            const goals = localStorage.getItem(GOALS_STORAGE_KEY);
            try {
                return goals ? JSON.parse(goals) : [];
            } catch (e) {
                console.error("Error parsing goals from localStorage:", e);
                return [];
            }
        }

        function saveGoals(goals) {
            localStorage.setItem(GOALS_STORAGE_KEY, JSON.stringify(goals));
        }

        function displayGoals(goalsListElement) {
            if (!goalsListElement) {
                console.error("Goals list element not provided for displayGoals");
                return;
            }
            const goals = getGoals();
            goalsListElement.innerHTML = ''; // Clear current list

            if (goals.length === 0) {
                goalsListElement.innerHTML = '<p class="text-gray-500">Chưa có mục tiêu nào.</p>';
                return;
            }

            // Sort goals: incomplete first, then by creation date (newest first)
            goals.sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1; // Incomplete goals come first
                }
                return b.createdAt - a.createdAt; // Then newest first
            });


            goals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.dataset.goalId = goal.id;
                goalElement.classList.add('goal-item'); // Use specific goal item class
                if (goal.completed) {
                    goalElement.classList.add('completed'); // Add class if completed
                }

                // Goal Name
                const nameElement = document.createElement('span');
                nameElement.classList.add('goal-name');
                nameElement.textContent = goal.name;

                // Action Buttons Container
                const buttonContainer = document.createElement('div');
                buttonContainer.classList.add('flex-shrink-0', 'flex');

                // Complete/Undo Button
                const completeButton = document.createElement('button');
                completeButton.classList.add(
                    goal.completed ? 'text-yellow-600' : 'text-green-600', // Style based on state
                    goal.completed ? 'hover:text-yellow-800' : 'hover:text-green-800',
                    'action-button'
                );
                completeButton.textContent = goal.completed ? 'Hoàn tác' : 'Hoàn thành';
                completeButton.onclick = () => toggleGoalComplete(goal.id, goalsListElement);

                // Delete Button
                const deleteButton = document.createElement('button');
                deleteButton.classList.add('text-red-500', 'hover:text-red-700', 'action-button');
                deleteButton.textContent = 'Xóa';
                deleteButton.onclick = () => deleteGoal(goal.id, goalsListElement);

                buttonContainer.appendChild(completeButton);
                buttonContainer.appendChild(deleteButton);

                goalElement.appendChild(nameElement);
                goalElement.appendChild(buttonContainer);
                goalsListElement.appendChild(goalElement);
            });
        }

        function addGoal(goalInputElement, goalsListElement) {
            if (!goalInputElement || !goalsListElement) return;
            const goalName = goalInputElement.value.trim();

            if (goalName) {
                const goals = getGoals();
                const now = Date.now();
                const newGoal = {
                    id: now,
                    name: goalName,
                    completed: false, // Default to not completed
                    createdAt: now
                };
                goals.push(newGoal);
                saveGoals(goals);
                goalInputElement.value = ''; // Clear input field
                displayGoals(goalsListElement); // Refresh the list
                console.log("Added goal:", newGoal);
            } else {
                console.log("Goal name is empty.");
                // Optionally show an error message
            }
        }

        function deleteGoal(goalId, goalsListElement) {
            if (!window.confirm("Bạn có chắc muốn xóa mục tiêu này không?")) {
                return;
            }
            let goals = getGoals();
            goals = goals.filter(goal => goal.id !== goalId);
            saveGoals(goals);
            displayGoals(goalsListElement); // Refresh the list
            console.log("Deleted goal ID:", goalId);
        }

        function toggleGoalComplete(goalId, goalsListElement) {
            let goals = getGoals();
            const goalIndex = goals.findIndex(goal => goal.id === goalId);

            if (goalIndex > -1) {
                goals[goalIndex].completed = !goals[goalIndex].completed; // Toggle the completed status
                // Optionally update a modifiedAt timestamp here if needed
                saveGoals(goals);
                displayGoals(goalsListElement); // Refresh the list to show changes
                console.log(`Toggled completion for goal ID: ${goalId} to ${goals[goalIndex].completed}`);
            } else {
                console.error("Could not find goal to toggle completion:", goalId);
            }
        }


        // --- Initialization and Event Listeners ---

        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const selectedModule = event.target.dataset.module;
                if (selectedModule && selectedModule !== currentModule) {
                    currentModule = selectedModule;
                    renderAppContent();
                }
            });
        });

        document.addEventListener('DOMContentLoaded', renderAppContent);

        console.log("Personal App with Notes and Goals modules is ready!");

    </script>

</body>
</html>
